<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - Sys-Scan Code Coverage Report - core/JSONWriter.cpp</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="title">LCOV - code coverage report</td></tr>
            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

            <tr>
              <td width="100%">
                <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="10%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">core</a> - JSONWriter.cpp<span style="font-size: 80%;"> (source / <a href="JSONWriter.cpp.func-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="5%"></td>
            <td width="5%" class="headerCovTableHead">Coverage</td>
            <td width="5%" class="headerCovTableHead" title="Covered + Uncovered code">Total</td>
            <td width="5%" class="headerCovTableHead" title="Exercised code only">Hit</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">Sys-Scan Code Coverage Report</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntryMed">83.8&nbsp;%</td>
            <td class="headerCovTableEntry">111</td>
            <td class="headerCovTableEntry">93</td>
          </tr>
          <tr>
            <td class="headerItem">Test Date:</td>
            <td class="headerValue">2025-09-11 14:32:57</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntryHi">100.0&nbsp;%</td>
            <td class="headerCovTableEntry">18</td>
            <td class="headerCovTableEntry">18</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
                  <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
                </table>
              </td>
            </tr>

            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
          </table>

          <table cellpadding=0 cellspacing=0 border=0>
            <tr>
              <td><br></td>
            </tr>
            <tr>
              <td>
<pre class="sourceHeading">            Line data    Source code</pre>
<pre class="source">
<span id="L1"><span class="lineNum">       1</span>              : #include &quot;JSONWriter.h&quot;</span>
<span id="L2"><span class="lineNum">       2</span>              : #include &lt;sstream&gt;</span>
<span id="L3"><span class="lineNum">       3</span>              : #include &lt;iomanip&gt;</span>
<span id="L4"><span class="lineNum">       4</span>              : #include &lt;chrono&gt;</span>
<span id="L5"><span class="lineNum">       5</span>              : #include &lt;algorithm&gt;</span>
<span id="L6"><span class="lineNum">       6</span>              : #include &lt;map&gt;</span>
<span id="L7"><span class="lineNum">       7</span>              : #include &lt;unistd.h&gt;</span>
<span id="L8"><span class="lineNum">       8</span>              : #include &lt;sys/utsname.h&gt;</span>
<span id="L9"><span class="lineNum">       9</span>              : #include &lt;pwd.h&gt;</span>
<span id="L10"><span class="lineNum">      10</span>              : #include &lt;fstream&gt;</span>
<span id="L11"><span class="lineNum">      11</span>              : #include &quot;Config.h&quot;</span>
<span id="L12"><span class="lineNum">      12</span>              : #include &quot;Severity.h&quot;</span>
<span id="L13"><span class="lineNum">      13</span>              : #include &lt;ctime&gt;</span>
<span id="L14"><span class="lineNum">      14</span>              : #include &lt;vector&gt;</span>
<span id="L15"><span class="lineNum">      15</span>              : #include &quot;JsonUtil.h&quot;</span>
<span id="L16"><span class="lineNum">      16</span>              : #include &quot;BuildInfo.h&quot;</span>
<span id="L17"><span class="lineNum">      17</span>              : #include &lt;iostream&gt;</span>
<span id="L18"><span class="lineNum">      18</span>              : </span>
<span id="L19"><span class="lineNum">      19</span>              : namespace sys_scan {</span>
<span id="L20"><span class="lineNum">      20</span>              : namespace {</span>
<span id="L21"><span class="lineNum">      21</span>              :     struct HostMeta {</span>
<span id="L22"><span class="lineNum">      22</span>              :         std::string hostname;</span>
<span id="L23"><span class="lineNum">      23</span>              :         std::string kernel;</span>
<span id="L24"><span class="lineNum">      24</span>              :         std::string arch;</span>
<span id="L25"><span class="lineNum">      25</span>              :         std::string os_pretty;</span>
<span id="L26"><span class="lineNum">      26</span>              :         std::string os_id;</span>
<span id="L27"><span class="lineNum">      27</span>              :         std::string os_version;</span>
<span id="L28"><span class="lineNum">      28</span>              :         std::string user;</span>
<span id="L29"><span class="lineNum">      29</span>              :         int uid=0,euid=0,gid=0,egid=0;</span>
<span id="L30"><span class="lineNum">      30</span>              :         std::string cmdline;</span>
<span id="L31"><span class="lineNum">      31</span>              :     };</span>
<span id="L32"><span class="lineNum">      32</span>              : </span>
<span id="L33"><span class="lineNum">      33</span>              :     struct CanonVal {</span>
<span id="L34"><span class="lineNum">      34</span>              :         enum Type { T_OBJ, T_ARR, T_STR, T_NUM } type = T_OBJ;</span>
<span id="L35"><span class="lineNum">      35</span>              :         std::map&lt;std::string, CanonVal&gt; obj;</span>
<span id="L36"><span class="lineNum">      36</span>              :         std::vector&lt;CanonVal&gt; arr;</span>
<span id="L37"><span class="lineNum">      37</span>              :         std::string str; // for string &amp; number token text</span>
<span id="L38"><span class="lineNum">      38</span> <span class="tlaGNC tlaBgGNC">      165058 :         CanonVal() = default;</span></span>
<span id="L39"><span class="lineNum">      39</span> <span class="tlaGNC">       38612 :         explicit CanonVal(Type t): type(t) {}</span></span>
<span id="L40"><span class="lineNum">      40</span>              :     };</span>
<span id="L41"><span class="lineNum">      41</span>              : </span>
<span id="L42"><span class="lineNum">      42</span>              :     // Forward decls</span>
<span id="L43"><span class="lineNum">      43</span>              :     static void canon_emit(const CanonVal&amp; v, std::ostream&amp; os);</span>
<span id="L44"><span class="lineNum">      44</span>              : </span>
<span id="L45"><span class="lineNum">      45</span>              :     using jsonutil::escape; using jsonutil::time_to_iso;</span>
<span id="L46"><span class="lineNum">      46</span>              : </span>
<span id="L47"><span class="lineNum">      47</span> <span class="tlaGNC">          72 :     static HostMeta collect_host_meta(){ HostMeta h; struct utsname u{}; if(uname(&amp;u)==0){ h.kernel=u.release; h.arch=u.machine; h.hostname=u.nodename; }</span></span>
<span id="L48"><span class="lineNum">      48</span>              :         // OS release</span>
<span id="L49"><span class="lineNum">      49</span> <span class="tlaGNC">        1008 :         std::ifstream f(&quot;/etc/os-release&quot;); std::string line; while(std::getline(f,line)){ if(line.rfind(&quot;PRETTY_NAME=&quot;,0)==0){ std::string v=line.substr(12); if(v.size()&amp;&amp;v.front()=='&quot;'&amp;&amp;v.back()=='&quot;') v=v.substr(1,v.size()-2); h.os_pretty=v; } else if(line.rfind(&quot;ID=&quot;,0)==0){ std::string v=line.substr(3); if(v.size()&amp;&amp;v.front()=='&quot;'&amp;&amp;v.back()=='&quot;') v=v.substr(1,v.size()-2); h.os_id=v; } else if(line.rfind(&quot;VERSION_ID=&quot;,0)==0){ std::string v=line.substr(11); if(v.size()&amp;&amp;v.front()=='&quot;'&amp;&amp;v.back()=='&quot;') v=v.substr(1,v.size()-2); h.os_version=v; } }</span></span>
<span id="L50"><span class="lineNum">      50</span> <span class="tlaGNC">          72 :         h.uid=getuid(); h.euid=geteuid(); h.gid=getgid(); h.egid=getegid(); if(auto* pw=getpwuid(h.uid); pw) h.user=pw-&gt;pw_name;</span></span>
<span id="L51"><span class="lineNum">      51</span>              :         // cmdline</span>
<span id="L52"><span class="lineNum">      52</span> <span class="tlaGNC">        5520 :         std::ifstream cf(&quot;/proc/self/cmdline&quot;, std::ios::binary); std::string raw((std::istreambuf_iterator&lt;char&gt;(cf)), {}); for(char c: raw){ if(c=='\0') h.cmdline.push_back(' '); else h.cmdline.push_back(c);} if(!h.cmdline.empty() &amp;&amp; h.cmdline.front()==' ') h.cmdline.erase(h.cmdline.begin()); return h; }</span></span>
<span id="L53"><span class="lineNum">      53</span>              : </span>
<span id="L54"><span class="lineNum">      54</span> <span class="tlaGNC">          72 :     static void apply_meta_overrides(HostMeta&amp; h){</span></span>
<span id="L55"><span class="lineNum">      55</span> <span class="tlaGNC">         576 :         auto get = [](const char* k)-&gt;const char*{ const char* v=getenv(k); return (v &amp;&amp; *v)? v: nullptr; };</span></span>
<span id="L56"><span class="lineNum">      56</span> <span class="tlaGNC">          72 :         if(auto v=get(&quot;SYS_SCAN_META_HOSTNAME&quot;)) h.hostname=v;</span></span>
<span id="L57"><span class="lineNum">      57</span> <span class="tlaGNC">          72 :         if(auto v=get(&quot;SYS_SCAN_META_KERNEL&quot;)) h.kernel=v;</span></span>
<span id="L58"><span class="lineNum">      58</span> <span class="tlaGNC">          72 :         if(auto v=get(&quot;SYS_SCAN_META_ARCH&quot;)) h.arch=v;</span></span>
<span id="L59"><span class="lineNum">      59</span> <span class="tlaGNC">          72 :         if(auto v=get(&quot;SYS_SCAN_META_OS_PRETTY&quot;)) h.os_pretty=v;</span></span>
<span id="L60"><span class="lineNum">      60</span> <span class="tlaGNC">          72 :         if(auto v=get(&quot;SYS_SCAN_META_OS_ID&quot;)) h.os_id=v;</span></span>
<span id="L61"><span class="lineNum">      61</span> <span class="tlaGNC">          72 :         if(auto v=get(&quot;SYS_SCAN_META_OS_VERSION&quot;)) h.os_version=v;</span></span>
<span id="L62"><span class="lineNum">      62</span> <span class="tlaGNC">          72 :         if(auto v=get(&quot;SYS_SCAN_META_USER&quot;)) h.user=v;</span></span>
<span id="L63"><span class="lineNum">      63</span> <span class="tlaGNC">          72 :         if(auto v=get(&quot;SYS_SCAN_META_CMDLINE&quot;)) h.cmdline=v;</span></span>
<span id="L64"><span class="lineNum">      64</span>              :         // numeric ids not overridden for now (could be added if needed)</span>
<span id="L65"><span class="lineNum">      65</span> <span class="tlaGNC">          72 :     }</span></span>
<span id="L66"><span class="lineNum">      66</span>              : </span>
<span id="L67"><span class="lineNum">      67</span> <span class="tlaGNC">      344262 :     static void canon_emit(const CanonVal&amp; v, std::ostream&amp; os){ switch(v.type){ case CanonVal::T_STR: os&lt;&lt;'&quot;'&lt;&lt;escape(v.str)&lt;&lt;'&quot;'; break; case CanonVal::T_NUM: os&lt;&lt;v.str; break; case CanonVal::T_ARR: { os&lt;&lt;'['; bool first=true; for(const auto&amp; e: v.arr){ if(!first) os&lt;&lt;','; first=false; canon_emit(e,os);} os&lt;&lt;']'; } break; case CanonVal::T_OBJ: { os&lt;&lt;'{'; bool first=true; for(const auto&amp; kv: v.obj){ if(!first) os&lt;&lt;','; first=false; os&lt;&lt;'&quot;'&lt;&lt;escape(kv.first)&lt;&lt;'&quot;'&lt;&lt;':'; canon_emit(kv.second, os);} os&lt;&lt;'}'; } break; } }</span></span>
<span id="L68"><span class="lineNum">      68</span> <span class="tlaGNC">      147236 : static CanonVal build_canonical(const Report&amp; report, long long total_risk_all, long long emitted_risk, size_t finding_total_all, size_t scanners_with_findings, long long duration_ms, const std::string&amp; slowest_name, long long slowest_ms, std::chrono::system_clock::time_point earliest, std::chrono::system_clock::time_point latest, const std::map&lt;std::string,size_t&gt;&amp; severity_counts_all, const std::map&lt;std::string,size_t&gt;&amp; severity_counts_emitted, const HostMeta&amp; host, const Config&amp; cfg){ bool zero_time=!!std::getenv(&quot;SYS_SCAN_CANON_TIME_ZERO&quot;); if(zero_time){ earliest={}; latest={}; duration_ms=0; } CanonVal root{CanonVal::T_OBJ}; auto put_str=[&amp;](CanonVal&amp; o,const std::string&amp; k,const std::string&amp; v){ o.obj[k].type=CanonVal::T_STR; o.obj[k].str=v; }; auto put_num=[&amp;](CanonVal&amp; o,const std::string&amp; k,long long v){ o.obj[k].type=CanonVal::T_NUM; o.obj[k].str=std::to_string(v); }; CanonVal meta{CanonVal::T_OBJ}; put_str(meta,&quot;$schema&quot;,&quot;https://github.com/J-mazz/sys-scan/schema/v2.json&quot;); put_str(meta,&quot;arch&quot;,host.arch);     if(!cfg.no_cmdline_meta &amp;&amp; !host.cmdline.empty()) put_str(meta,&quot;cmdline&quot;,host.cmdline);     if(!cfg.no_user_meta){ put_str(meta,&quot;egid&quot;,std::to_string(host.egid)); put_str(meta,&quot;euid&quot;,std::to_string(host.euid)); put_str(meta,&quot;gid&quot;,std::to_string(host.gid)); put_str(meta,&quot;uid&quot;,std::to_string(host.uid)); put_str(meta,&quot;user&quot;,host.user);} if(!cfg.no_hostname_meta) put_str(meta,&quot;hostname&quot;,host.hostname); put_str(meta,&quot;json_schema_version&quot;,&quot;2&quot;); put_str(meta,&quot;kernel&quot;,host.kernel); put_str(meta,&quot;os_id&quot;,host.os_id); if(!host.os_pretty.empty()) put_str(meta,&quot;os_pretty&quot;,host.os_pretty); if(!host.os_version.empty()) put_str(meta,&quot;os_version&quot;,host.os_version); put_str(meta,&quot;tool_version&quot;, buildinfo::APP_VERSION); if(std::getenv(&quot;SYS_SCAN_CANON_TIME_ZERO&quot;)) put_str(meta,&quot;normalized_time&quot;,&quot;true&quot;);</span></span>
<span id="L69"><span class="lineNum">      69</span>              :     // Post-construction hardening (idempotent): enforce suppression flags even if earlier logic added fields</span>
<span id="L70"><span class="lineNum">      70</span> <span class="tlaGNC">          92 :     if(cfg.no_user_meta){ meta.obj.erase(&quot;uid&quot;); meta.obj.erase(&quot;euid&quot;); meta.obj.erase(&quot;gid&quot;); meta.obj.erase(&quot;egid&quot;); meta.obj.erase(&quot;user&quot;); }</span></span>
<span id="L71"><span class="lineNum">      71</span> <span class="tlaGNC">          76 :     if(cfg.no_cmdline_meta){ meta.obj.erase(&quot;cmdline&quot;); }</span></span>
<span id="L72"><span class="lineNum">      72</span> <span class="tlaGNC">          76 :     if(cfg.no_hostname_meta){ meta.obj.erase(&quot;hostname&quot;); }</span></span>
<span id="L73"><span class="lineNum">      73</span>              :     // Provenance sub-object (stable ordering by embedding keys deterministically)</span>
<span id="L74"><span class="lineNum">      74</span> <span class="tlaGNC">         504 :     auto env_or=[&amp;](const char* name, const char* defv){ const char* v = std::getenv(name); return (v &amp;&amp; *v)? v: defv; };</span></span>
<span id="L75"><span class="lineNum">      75</span> <span class="tlaGNC">          72 :     CanonVal prov{CanonVal::T_OBJ};</span></span>
<span id="L76"><span class="lineNum">      76</span> <span class="tlaGNC">         288 :     put_str(prov,&quot;compiler_id&quot;, env_or(&quot;SYS_SCAN_PROV_COMPILER_ID&quot;, buildinfo::COMPILER_ID));</span></span>
<span id="L77"><span class="lineNum">      77</span> <span class="tlaGNC">         288 :     put_str(prov,&quot;compiler_version&quot;, env_or(&quot;SYS_SCAN_PROV_COMPILER_VERSION&quot;, buildinfo::COMPILER_VERSION));</span></span>
<span id="L78"><span class="lineNum">      78</span> <span class="tlaGNC">         288 :     put_str(prov,&quot;git_commit&quot;, env_or(&quot;SYS_SCAN_PROV_GIT_COMMIT&quot;, buildinfo::GIT_COMMIT));</span></span>
<span id="L79"><span class="lineNum">      79</span> <span class="tlaGNC">         288 :     put_str(prov,&quot;cxx_standard&quot;, env_or(&quot;SYS_SCAN_PROV_CXX_STANDARD&quot;, buildinfo::CXX_STANDARD));</span></span>
<span id="L80"><span class="lineNum">      80</span> <span class="tlaGNC">         216 :     put_str(prov,&quot;cxx_flags&quot;, env_or(&quot;SYS_SCAN_PROV_CXX_FLAGS&quot;, buildinfo::CXX_FLAGS));</span></span>
<span id="L81"><span class="lineNum">      81</span> <span class="tlaGNC">         216 :     const char* slsa_rt = std::getenv(&quot;SYS_SCAN_SLSA_LEVEL_RUNTIME&quot;); std::string slsa = slsa_rt? slsa_rt: env_or(&quot;SYS_SCAN_PROV_SLSA_LEVEL&quot;, buildinfo::SLSA_LEVEL);</span></span>
<span id="L82"><span class="lineNum">      82</span> <span class="tlaGNC">         144 :     put_str(prov,&quot;slsa_level&quot;, slsa);</span></span>
<span id="L83"><span class="lineNum">      83</span> <span class="tlaGNC">         216 :     put_str(prov,&quot;build_type&quot;, env_or(&quot;SYS_SCAN_PROV_BUILD_TYPE&quot;, buildinfo::BUILD_TYPE));</span></span>
<span id="L84"><span class="lineNum">      84</span> <span class="tlaGNC">         144 :     meta.obj[&quot;provenance&quot;] = std::move(prov);</span></span>
<span id="L85"><span class="lineNum">      85</span>              :     // Append effective_config (selected sanitized fields) for transparency</span>
<span id="L86"><span class="lineNum">      86</span>              :     {</span>
<span id="L87"><span class="lineNum">      87</span> <span class="tlaGNC">          72 :         const auto&amp; cfg_config = cfg;</span></span>
<span id="L88"><span class="lineNum">      88</span> <span class="tlaGNC">          72 :         CanonVal ec{CanonVal::T_OBJ};</span></span>
<span id="L89"><span class="lineNum">      89</span> <span class="tlaGNC">        1656 :         auto put_bool=[&amp;](const std::string&amp; k,bool v){ ec.obj[k].type=CanonVal::T_STR; ec.obj[k].str = v?&quot;true&quot;:&quot;false&quot;; };</span></span>
<span id="L90"><span class="lineNum">      90</span> <span class="tlaGNC">         360 :         auto put_numec=[&amp;](const std::string&amp; k,long long v){ ec.obj[k].type=CanonVal::T_NUM; ec.obj[k].str=std::to_string(v); };</span></span>
<span id="L91"><span class="lineNum">      91</span> <span class="tlaGNC">         216 :         auto put_strec=[&amp;](const std::string&amp; k,const std::string&amp; v){ if(!v.empty()){ ec.obj[k].type=CanonVal::T_STR; ec.obj[k].str=v; } };</span></span>
<span id="L92"><span class="lineNum">      92</span> <span class="tlaGNC">         144 :         put_strec(&quot;min_severity&quot;, cfg_config.min_severity);</span></span>
<span id="L93"><span class="lineNum">      93</span> <span class="tlaGNC">         144 :         put_strec(&quot;fail_on_severity&quot;, cfg_config.fail_on_severity);</span></span>
<span id="L94"><span class="lineNum">      94</span> <span class="tlaGNC">         144 :         put_bool(&quot;canonical&quot;, cfg_config.canonical);</span></span>
<span id="L95"><span class="lineNum">      95</span> <span class="tlaGNC">         144 :         put_bool(&quot;ndjson&quot;, cfg_config.ndjson);</span></span>
<span id="L96"><span class="lineNum">      96</span> <span class="tlaGNC">         144 :         put_bool(&quot;sarif&quot;, cfg_config.sarif);</span></span>
<span id="L97"><span class="lineNum">      97</span> <span class="tlaGNC">         144 :         put_bool(&quot;pretty&quot;, cfg_config.pretty);</span></span>
<span id="L98"><span class="lineNum">      98</span> <span class="tlaGNC">         144 :         put_bool(&quot;compact&quot;, cfg_config.compact);</span></span>
<span id="L99"><span class="lineNum">      99</span> <span class="tlaGNC">         144 :         put_bool(&quot;rules_enable&quot;, cfg_config.rules_enable);</span></span>
<span id="L100"><span class="lineNum">     100</span> <span class="tlaGNC">         144 :         put_bool(&quot;integrity&quot;, cfg_config.integrity);</span></span>
<span id="L101"><span class="lineNum">     101</span> <span class="tlaGNC">         144 :         put_bool(&quot;integrity_pkg_verify&quot;, cfg_config.integrity_pkg_verify);</span></span>
<span id="L102"><span class="lineNum">     102</span> <span class="tlaGNC">         144 :         put_bool(&quot;integrity_pkg_rehash&quot;, cfg_config.integrity_pkg_rehash);</span></span>
<span id="L103"><span class="lineNum">     103</span> <span class="tlaGNC">         144 :         put_numec(&quot;integrity_pkg_rehash_limit&quot;, cfg_config.integrity_pkg_rehash_limit);</span></span>
<span id="L104"><span class="lineNum">     104</span> <span class="tlaGNC">         144 :         put_bool(&quot;modules_hash&quot;, cfg_config.modules_hash);</span></span>
<span id="L105"><span class="lineNum">     105</span> <span class="tlaGNC">         144 :         put_bool(&quot;modules_summary_only&quot;, cfg_config.modules_summary_only);</span></span>
<span id="L106"><span class="lineNum">     106</span> <span class="tlaGNC">         144 :         put_bool(&quot;modules_anomalies_only&quot;, cfg_config.modules_anomalies_only);</span></span>
<span id="L107"><span class="lineNum">     107</span> <span class="tlaGNC">         144 :         put_bool(&quot;fs_hygiene&quot;, cfg_config.fs_hygiene);</span></span>
<span id="L108"><span class="lineNum">     108</span> <span class="tlaGNC">         144 :         put_numec(&quot;fs_world_writable_limit&quot;, cfg_config.fs_world_writable_limit);</span></span>
<span id="L109"><span class="lineNum">     109</span> <span class="tlaGNC">         144 :         put_bool(&quot;process_inventory&quot;, cfg_config.process_inventory);</span></span>
<span id="L110"><span class="lineNum">     110</span> <span class="tlaGNC">         144 :         put_bool(&quot;ioc_exec_trace&quot;, cfg_config.ioc_exec_trace);</span></span>
<span id="L111"><span class="lineNum">     111</span> <span class="tlaGNC">         144 :         put_numec(&quot;ioc_exec_trace_seconds&quot;, cfg_config.ioc_exec_trace_seconds);</span></span>
<span id="L112"><span class="lineNum">     112</span> <span class="tlaGNC">         144 :         put_bool(&quot;ioc_env_trust&quot;, cfg_config.ioc_env_trust);</span></span>
<span id="L113"><span class="lineNum">     113</span> <span class="tlaGNC">         144 :         put_bool(&quot;parallel&quot;, cfg_config.parallel);</span></span>
<span id="L114"><span class="lineNum">     114</span> <span class="tlaGNC">         144 :         put_numec(&quot;parallel_max_threads&quot;, cfg_config.parallel_max_threads);</span></span>
<span id="L115"><span class="lineNum">     115</span> <span class="tlaGNC">         144 :         put_bool(&quot;containers&quot;, cfg_config.containers);</span></span>
<span id="L116"><span class="lineNum">     116</span> <span class="tlaGNC">         144 :         put_bool(&quot;hardening&quot;, cfg_config.hardening);</span></span>
<span id="L117"><span class="lineNum">     117</span> <span class="tlaGNC">         144 :         put_bool(&quot;seccomp&quot;, cfg_config.seccomp);</span></span>
<span id="L118"><span class="lineNum">     118</span> <span class="tlaGNC">         144 :         put_bool(&quot;seccomp_strict&quot;, cfg_config.seccomp_strict);</span></span>
<span id="L119"><span class="lineNum">     119</span> <span class="tlaGNC">         144 :         put_bool(&quot;compliance&quot;, cfg_config.compliance);</span></span>
<span id="L120"><span class="lineNum">     120</span> <span class="tlaGNC">         144 :         meta.obj[&quot;effective_config&quot;] = std::move(ec);</span></span>
<span id="L121"><span class="lineNum">     121</span> <span class="tlaGNC">          72 :     }</span></span>
<span id="L122"><span class="lineNum">     122</span>              :     // Optional per-scanner timings</span>
<span id="L123"><span class="lineNum">     123</span> <span class="tlaGNC">          72 :     if(cfg.timings){</span></span>
<span id="L124"><span class="lineNum">     124</span> <span class="tlaUNC tlaBgUNC">           0 :         CanonVal timings{CanonVal::T_ARR};</span></span>
<span id="L125"><span class="lineNum">     125</span> <span class="tlaUNC">           0 :         for(const auto&amp; r : report.results()){</span></span>
<span id="L126"><span class="lineNum">     126</span> <span class="tlaUNC">           0 :             long long elapsed_ms=0; if(r.start_time.time_since_epoch().count() &amp;&amp; r.end_time.time_since_epoch().count() &amp;&amp; r.end_time&gt;=r.start_time) elapsed_ms=std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(r.end_time-r.start_time).count();</span></span>
<span id="L127"><span class="lineNum">     127</span> <span class="tlaUNC">           0 :             CanonVal t{CanonVal::T_OBJ}; put_str(t,&quot;scanner&quot;, r.scanner_name); put_num(t,&quot;elapsed_ms&quot;, elapsed_ms); timings.arr.push_back(std::move(t));</span></span>
<span id="L128"><span class="lineNum">     128</span> <span class="tlaUNC">           0 :         }</span></span>
<span id="L129"><span class="lineNum">     129</span> <span class="tlaUNC">           0 :         meta.obj[&quot;timings&quot;] = std::move(timings);</span></span>
<span id="L130"><span class="lineNum">     130</span> <span class="tlaUNC">           0 :     }</span></span>
<span id="L131"><span class="lineNum">     131</span> <span class="tlaGNC tlaBgGNC">         360 :     root.obj[&quot;meta&quot;]=std::move(meta); CanonVal summary{CanonVal::T_OBJ}; put_num(summary,&quot;duration_ms&quot;,duration_ms); size_t emitted_total=0; double fps=(duration_ms&gt;0)?(0*1000.0/duration_ms):0.0; // placeholder, recomputed later</span></span>
<span id="L132"><span class="lineNum">     132</span> <span class="tlaGNC">         504 :  { std::ostringstream tmp; tmp.setf(std::ios::fixed); tmp&lt;&lt;std::setprecision(2)&lt;&lt;fps; std::string s=tmp.str(); if(s.size()&gt;1){ while(s.size()&gt;1 &amp;&amp; s.back()=='0') s.pop_back(); if(!s.empty()&amp;&amp;s.back()=='.') s.push_back('0'); } summary.obj[&quot;findings_per_second&quot;].type=CanonVal::T_NUM; summary.obj[&quot;findings_per_second&quot;].str=s; }</span></span>
<span id="L133"><span class="lineNum">     133</span> <span class="tlaGNC">      416817 :  put_num(summary,&quot;finding_count_total&quot;, finding_total_all); put_num(summary,&quot;finding_count_emitted&quot;, 0); put_str(summary,&quot;finished_at&quot;, time_to_iso(latest)); put_str(summary,&quot;scanner_count&quot;, std::to_string(report.results().size())); put_num(summary,&quot;scanners_with_findings&quot;, scanners_with_findings); CanonVal sev_all{CanonVal::T_OBJ}; for(const auto&amp; kv: severity_counts_all){ put_num(sev_all, kv.first, kv.second);} summary.obj[&quot;severity_counts&quot;]=std::move(sev_all); CanonVal sev_emit{CanonVal::T_OBJ}; for(const auto&amp; kv: severity_counts_emitted){ put_num(sev_emit, kv.first, kv.second);} summary.obj[&quot;severity_counts_emitted&quot;]=std::move(sev_emit); CanonVal slow{CanonVal::T_OBJ}; put_str(slow,&quot;elapsed_ms&quot;, std::to_string(slowest_ms)); put_str(slow,&quot;name&quot;, slowest_name); summary.obj[&quot;slowest_scanner&quot;]=std::move(slow); put_str(summary,&quot;started_at&quot;, time_to_iso(earliest)); root.obj[&quot;summary&quot;]=std::move(summary); CanonVal res_arr{CanonVal::T_ARR}; for(const auto&amp; r: report.results()){ CanonVal rs{CanonVal::T_OBJ}; put_str(rs,&quot;scanner&quot;, r.scanner_name); put_str(rs,&quot;start_time&quot;, zero_time?&quot;&quot;:time_to_iso(r.start_time)); put_str(rs,&quot;end_time&quot;, zero_time?&quot;&quot;:time_to_iso(r.end_time)); long long elapsed_ms=0; if(!zero_time &amp;&amp; r.start_time.time_since_epoch().count() &amp;&amp; r.end_time.time_since_epoch().count() &amp;&amp; r.end_time&gt;=r.start_time) elapsed_ms=std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(r.end_time-r.start_time).count(); put_num(rs,&quot;elapsed_ms&quot;, elapsed_ms);     std::vector&lt;const Finding*&gt; filtered; for(const auto&amp; f: r.findings){ if(severity_rank(cfg.min_severity)&lt;=severity_rank_enum(f.severity)) filtered.push_back(&amp;f);} put_num(rs,&quot;finding_count&quot;, filtered.size()); emitted_total += filtered.size(); CanonVal findings_arr{CanonVal::T_ARR}; if(cfg.canonical){ std::sort(filtered.begin(), filtered.end(), [](const Finding* a, const Finding* b){ return a-&gt;id &lt; b-&gt;id; }); } for(const auto* fp: filtered){ const auto&amp; f=*fp; CanonVal fv{CanonVal::T_OBJ}; put_str(fv,&quot;description&quot;, f.description); put_str(fv,&quot;id&quot;, f.id); put_str(fv,&quot;base_severity_score&quot;, std::to_string(f.base_severity_score)); put_str(fv,&quot;severity&quot;, severity_to_string(f.severity)); put_str(fv,&quot;title&quot;, f.title); CanonVal meta_md{CanonVal::T_OBJ}; std::vector&lt;std::pair&lt;std::string,std::string&gt;&gt; meta_sorted(f.metadata.begin(), f.metadata.end()); std::sort(meta_sorted.begin(), meta_sorted.end(),[](auto&amp;a,auto&amp;b){ return a.first&lt;b.first;}); for(const auto&amp; kv: meta_sorted){ put_str(meta_md, kv.first, kv.second);} fv.obj[&quot;metadata&quot;]=std::move(meta_md); findings_arr.arr.push_back(std::move(fv)); } rs.obj[&quot;findings&quot;]=std::move(findings_arr); res_arr.arr.push_back(std::move(rs)); } root.obj[&quot;results&quot;]=std::move(res_arr); // patch in emitted totals</span></span>
<span id="L134"><span class="lineNum">     134</span> <span class="tlaGNC">         509 :  put_num(root.obj[&quot;summary&quot;],&quot;finding_count_emitted&quot;, emitted_total); if(duration_ms&gt;0){ double fps2 = emitted_total*1000.0/duration_ms; std::ostringstream tmp; tmp.setf(std::ios::fixed); tmp&lt;&lt;std::setprecision(2)&lt;&lt;fps2; std::string s=tmp.str(); while(s.size()&gt;1 &amp;&amp; s.back()=='0') s.pop_back(); if(!s.empty()&amp;&amp;s.back()=='.') s.push_back('0'); root.obj[&quot;summary&quot;].obj[&quot;findings_per_second&quot;].str=s; }</span></span>
<span id="L135"><span class="lineNum">     135</span> <span class="tlaGNC">        2222 :  CanonVal warns{CanonVal::T_ARR}; for(const auto&amp; w: report.warnings()){ CanonVal wv{CanonVal::T_OBJ}; // w.second format: code[:detail]</span></span>
<span id="L136"><span class="lineNum">     136</span> <span class="tlaGNC">        2150 :      auto pos = w.second.find(':'); std::string code = (pos==std::string::npos)? w.second : w.second.substr(0,pos); std::string detail = (pos==std::string::npos)? &quot;&quot; : w.second.substr(pos+1);</span></span>
<span id="L137"><span class="lineNum">     137</span> <span class="tlaGNC">       13630 :      put_str(wv,&quot;code&quot;, code); if(!detail.empty()) put_str(wv,&quot;detail&quot;, detail); put_str(wv,&quot;scanner&quot;, w.first); warns.arr.push_back(std::move(wv)); } root.obj[&quot;collection_warnings&quot;]=std::move(warns); CanonVal pwarns{CanonVal::T_ARR}; for(const auto&amp; w: report.partial_warnings()){ CanonVal wv{CanonVal::T_OBJ}; put_str(wv,&quot;message&quot;, w.second); put_str(wv,&quot;scanner&quot;, w.first); pwarns.arr.push_back(std::move(wv)); } if(!pwarns.arr.empty()) root.obj[&quot;partial_warnings&quot;]=std::move(pwarns); CanonVal errs{CanonVal::T_ARR}; for(const auto&amp; e: report.errors()){ CanonVal ev{CanonVal::T_OBJ}; put_str(ev,&quot;message&quot;, e.second); put_str(ev,&quot;scanner&quot;, e.first); errs.arr.push_back(std::move(ev)); } root.obj[&quot;scanner_errors&quot;]=std::move(errs); CanonVal se{CanonVal::T_OBJ}; put_num(se,&quot;total_risk_score&quot;, total_risk_all); put_num(se,&quot;emitted_risk_score&quot;, emitted_risk); root.obj[&quot;summary_extension&quot;]=std::move(se);</span></span>
<span id="L138"><span class="lineNum">     138</span>              :  // compliance_summary</span>
<span id="L139"><span class="lineNum">     139</span> <span class="tlaGNC">          72 :  if(!report.compliance_summary().empty()) {</span></span>
<span id="L140"><span class="lineNum">     140</span> <span class="tlaUNC tlaBgUNC">           0 :      CanonVal comp{CanonVal::T_OBJ};</span></span>
<span id="L141"><span class="lineNum">     141</span> <span class="tlaUNC">           0 :      for(const auto&amp; stdkv : report.compliance_summary()){</span></span>
<span id="L142"><span class="lineNum">     142</span> <span class="tlaUNC">           0 :          CanonVal stdobj{CanonVal::T_OBJ};</span></span>
<span id="L143"><span class="lineNum">     143</span> <span class="tlaUNC">           0 :          for(const auto&amp; mkv : stdkv.second){</span></span>
<span id="L144"><span class="lineNum">     144</span>              :              // try to detect numeric vs string (simple heuristic)</span>
<span id="L145"><span class="lineNum">     145</span> <span class="tlaUNC">           0 :              bool numeric=true; for(char c: mkv.second){ if((c&lt;'0'||c&gt;'9') &amp;&amp; c!='.' &amp;&amp; c!='-' ) { numeric=false; break; } }</span></span>
<span id="L146"><span class="lineNum">     146</span> <span class="tlaUNC">           0 :              if(numeric){ stdobj.obj[mkv.first].type=CanonVal::T_NUM; stdobj.obj[mkv.first].str=mkv.second; }</span></span>
<span id="L147"><span class="lineNum">     147</span> <span class="tlaUNC">           0 :              else { stdobj.obj[mkv.first].type=CanonVal::T_STR; stdobj.obj[mkv.first].str=mkv.second; }</span></span>
<span id="L148"><span class="lineNum">     148</span>              :          }</span>
<span id="L149"><span class="lineNum">     149</span> <span class="tlaUNC">           0 :          comp.obj[stdkv.first]=std::move(stdobj);</span></span>
<span id="L150"><span class="lineNum">     150</span> <span class="tlaUNC">           0 :      }</span></span>
<span id="L151"><span class="lineNum">     151</span> <span class="tlaUNC">           0 :      root.obj[&quot;compliance_summary&quot;]=std::move(comp);</span></span>
<span id="L152"><span class="lineNum">     152</span> <span class="tlaUNC">           0 :  }</span></span>
<span id="L153"><span class="lineNum">     153</span>              :  // After meta object population, enforce suppression flags</span>
<span id="L154"><span class="lineNum">     154</span>              :  // (Inserted by tool)</span>
<span id="L155"><span class="lineNum">     155</span>              :  // Post-construction hardening: ensure suppression flags are enforced</span>
<span id="L156"><span class="lineNum">     156</span>              :  // This is idempotent and guards against any future code paths that might</span>
<span id="L157"><span class="lineNum">     157</span>              :  // insert sensitive fields before flags are evaluated.</span>
<span id="L158"><span class="lineNum">     158</span> <span class="tlaGNC tlaBgGNC">          92 :  if(cfg.no_user_meta){ meta.obj.erase(&quot;uid&quot;); meta.obj.erase(&quot;euid&quot;); meta.obj.erase(&quot;gid&quot;); meta.obj.erase(&quot;egid&quot;); meta.obj.erase(&quot;user&quot;); }</span></span>
<span id="L159"><span class="lineNum">     159</span> <span class="tlaGNC">          76 :  if(cfg.no_cmdline_meta){ meta.obj.erase(&quot;cmdline&quot;); }</span></span>
<span id="L160"><span class="lineNum">     160</span> <span class="tlaGNC">          76 :  if(cfg.no_hostname_meta){ meta.obj.erase(&quot;hostname&quot;); }</span></span>
<span id="L161"><span class="lineNum">     161</span> <span class="tlaGNC">         144 :  return root; }</span></span>
<span id="L162"><span class="lineNum">     162</span>              : } // end anonymous namespace</span>
<span id="L163"><span class="lineNum">     163</span>              : </span>
<span id="L164"><span class="lineNum">     164</span>              : // Move write implementation outside anonymous namespace to correctly match class scope</span>
<span id="L165"><span class="lineNum">     165</span> <span class="tlaGNC">          72 : std::string JSONWriter::write(const Report&amp; report, const Config&amp; cfg) const {</span></span>
<span id="L166"><span class="lineNum">     166</span>              :     // Summary metrics</span>
<span id="L167"><span class="lineNum">     167</span> <span class="tlaGNC">       69970 :     const auto&amp; results = report.results(); size_t finding_total_all=0; std::map&lt;std::string,size_t&gt; severity_counts_all; std::map&lt;std::string,size_t&gt; severity_counts_emitted; long long total_risk_all=0; long long emitted_risk=0; std::chrono::system_clock::time_point earliest{}; std::chrono::system_clock::time_point latest{}; size_t scanners_with_findings=0; long long slowest_ms=0; std::string slowest_name; for(const auto&amp; r: results){ finding_total_all+=r.findings.size(); if(!r.findings.empty()) scanners_with_findings++; if(earliest.time_since_epoch().count()==0 || (r.start_time.time_since_epoch().count() &amp;&amp; r.start_time&lt;earliest)) earliest=r.start_time; if(r.end_time.time_since_epoch().count() &amp;&amp; (latest.time_since_epoch().count()==0 || r.end_time&gt;latest)) latest=r.end_time; auto elapsed=(r.end_time.time_since_epoch().count()&amp;&amp;r.start_time.time_since_epoch().count())? std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(r.end_time-r.start_time).count():0; if(elapsed&gt;slowest_ms){ slowest_ms=elapsed; slowest_name=r.scanner_name;} for(const auto&amp; f: r.findings){ severity_counts_all[severity_to_string(f.severity)]++; if(!f.operational_error){ total_risk_all+=f.base_severity_score; if(severity_rank(cfg.min_severity)&lt;=severity_rank_enum(f.severity)){ severity_counts_emitted[severity_to_string(f.severity)]++; emitted_risk+=f.base_severity_score; } } } } long long duration_ms=0; if(earliest.time_since_epoch().count() &amp;&amp; latest.time_since_epoch().count() &amp;&amp; latest&gt;=earliest) duration_ms=std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(latest-earliest).count(); auto host=collect_host_meta(); apply_meta_overrides(host); size_t emitted_total = 0; for(const auto&amp; pair : severity_counts_emitted) emitted_total += pair.second; CanonVal root = build_canonical(report,total_risk_all,emitted_risk,finding_total_all,scanners_with_findings,duration_ms,slowest_name,slowest_ms,earliest,latest,severity_counts_all,severity_counts_emitted,host,cfg);</span></span>
<span id="L168"><span class="lineNum">     168</span> <span class="tlaGNC">        2087 :     if(cfg.sarif){ std::ostringstream s; s &lt;&lt; &quot;{\&quot;$schema\&quot;:\&quot;https://schemastore.azurewebsites.net/schemas/json/sarif-2.1.0.json\&quot;,\&quot;version\&quot;:\&quot;2.1.0\&quot;,\&quot;runs\&quot;:[{&quot;; s &lt;&lt; &quot;\&quot;tool\&quot;:{\&quot;driver\&quot;:{\&quot;name\&quot;:\&quot;sys-scan\&quot;,\&quot;informationUri\&quot;:\&quot;https://github.com/J-mazz/sys-scan\&quot;}},&quot;; s &lt;&lt; &quot;\&quot;results\&quot;:[&quot;; bool first=true; int minRank=severity_rank(cfg.min_severity); for(const auto&amp; r: results){ for(const auto&amp; f: r.findings){ if(severity_rank_enum(f.severity)&lt;minRank) continue; if(!first) s&lt;&lt;&quot;,&quot;; first=false; s &lt;&lt; &quot;{\&quot;ruleId\&quot;:\&quot;&quot;&lt;&lt;escape(f.id)&lt;&lt;&quot;\&quot;,\&quot;level\&quot;:\&quot;&quot;&lt;&lt;escape(severity_to_string(f.severity))&lt;&lt;&quot;\&quot;,\&quot;message\&quot;:{\&quot;text\&quot;:\&quot;&quot;&lt;&lt;escape(f.title)&lt;&lt;&quot; - &quot;&lt;&lt;escape(f.description)&lt;&lt;&quot;\&quot;},\&quot;properties\&quot;:{\&quot;baseSeverityScore\&quot;:&quot;&lt;&lt;f.base_severity_score; auto it=f.metadata.find(&quot;mitre_techniques&quot;); if(it!=f.metadata.end()){ s &lt;&lt; &quot;,\&quot;mitreTechniqueIds\&quot;:[&quot;; std::string v=it-&gt;second; size_t pos=0; bool firstId=true; while(pos&lt;v.size()){ size_t comma=v.find(',',pos); std::string tok=v.substr(pos, comma==std::string::npos? std::string::npos: comma-pos); if(!tok.empty()){ if(!firstId) s&lt;&lt;&quot;,&quot;; firstId=false; s&lt;&lt;&quot;\&quot;&quot;&lt;&lt;escape(tok)&lt;&lt;&quot;\&quot;&quot;;} if(comma==std::string::npos) break; pos=comma+1;} s&lt;&lt;&quot;]&quot;; } s &lt;&lt; &quot;}}&quot;; } } s &lt;&lt; &quot;]}]}&quot;; return s.str(); }</span></span>
<span id="L169"><span class="lineNum">     169</span> <span class="tlaGNC">          76 :     if(cfg.ndjson){ std::ostringstream nd; nd &lt;&lt; '{' &lt;&lt; &quot;\&quot;type\&quot;:\&quot;meta\&quot;,\&quot;tool_version\&quot;:\&quot;&quot;&lt;&lt;escape(buildinfo::APP_VERSION)&lt;&lt;&quot;\&quot;,\&quot;schema\&quot;:\&quot;2\&quot;&quot;; if(std::getenv(&quot;SYS_SCAN_CANON_TIME_ZERO&quot;)) nd &lt;&lt; &quot;,\&quot;normalized_time\&quot;:\&quot;true\&quot;&quot;; if(!cfg.no_hostname_meta) nd &lt;&lt; &quot;,\&quot;hostname\&quot;:\&quot;&quot;&lt;&lt;escape(host.hostname)&lt;&lt;&quot;\&quot;&quot;; if(!cfg.no_user_meta){ nd &lt;&lt; &quot;,\&quot;uid\&quot;:&quot;&lt;&lt;host.uid&lt;&lt;&quot;,\&quot;euid\&quot;:&quot;&lt;&lt;host.euid&lt;&lt;&quot;,\&quot;gid\&quot;:&quot;&lt;&lt;host.gid&lt;&lt;&quot;,\&quot;egid\&quot;:&quot;&lt;&lt;host.egid&lt;&lt;&quot;,\&quot;user\&quot;:\&quot;&quot;&lt;&lt;escape(host.user)&lt;&lt;&quot;\&quot;&quot;; } if(!cfg.no_cmdline_meta &amp;&amp; !host.cmdline.empty()) nd &lt;&lt; &quot;,\&quot;cmdline\&quot;:\&quot;&quot;&lt;&lt;escape(host.cmdline)&lt;&lt;&quot;\&quot;&quot;; nd &lt;&lt; '}'; nd &lt;&lt; &quot;\n&quot;; </span></span>
<span id="L170"><span class="lineNum">     170</span>              :     // Add summary line</span>
<span id="L171"><span class="lineNum">     171</span> <span class="tlaGNC">           6 :     nd &lt;&lt; '{' &lt;&lt; &quot;\&quot;type\&quot;:\&quot;summary\&quot;,\&quot;duration_ms\&quot;:&quot;&lt;&lt;duration_ms&lt;&lt;&quot;,\&quot;finding_count_total\&quot;:&quot;&lt;&lt;finding_total_all&lt;&lt;&quot;,\&quot;finding_count_emitted\&quot;:&quot;&lt;&lt;emitted_total&lt;&lt;&quot;,\&quot;scanner_count\&quot;:&quot;&lt;&lt;results.size()&lt;&lt;&quot;,\&quot;scanners_with_findings\&quot;:&quot;&lt;&lt;scanners_with_findings; </span></span>
<span id="L172"><span class="lineNum">     172</span> <span class="tlaGNC">           6 :     if(!slowest_name.empty()) nd &lt;&lt; &quot;,\&quot;slowest_scanner\&quot;:{\&quot;name\&quot;:\&quot;&quot;&lt;&lt;escape(slowest_name)&lt;&lt;&quot;\&quot;,\&quot;elapsed_ms\&quot;:&quot;&lt;&lt;slowest_ms&lt;&lt;&quot;}&quot;;</span></span>
<span id="L173"><span class="lineNum">     173</span> <span class="tlaGNC">           6 :     nd &lt;&lt; '}'; nd &lt;&lt; &quot;\n&quot;;</span></span>
<span id="L174"><span class="lineNum">     174</span> <span class="tlaGNC">        1887 :     if(cfg.timings){ for(const auto&amp; r: results){ long long elapsed_ms=0; if(r.start_time.time_since_epoch().count() &amp;&amp; r.end_time.time_since_epoch().count() &amp;&amp; r.end_time&gt;=r.start_time) elapsed_ms=std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(r.end_time-r.start_time).count(); nd &lt;&lt; '{' &lt;&lt; &quot;\&quot;type\&quot;:\&quot;timing\&quot;,\&quot;scanner\&quot;:\&quot;&quot;&lt;&lt;escape(r.scanner_name)&lt;&lt;&quot;\&quot;,\&quot;elapsed_ms\&quot;:&quot;&lt;&lt;elapsed_ms&lt;&lt;'}'&lt;&lt;&quot;\n&quot;; } } nd &lt;&lt; '{' &lt;&lt; &quot;\&quot;type\&quot;:\&quot;summary_extension\&quot;,\&quot;total_risk_score\&quot;:&quot;&lt;&lt; total_risk_all &lt;&lt;&quot;,\&quot;emitted_risk_score\&quot;:&quot;&lt;&lt; emitted_risk &lt;&lt;'}' &lt;&lt;&quot;\n&quot;; int minRank=severity_rank(cfg.min_severity); for(const auto&amp; r: results){ for(const auto&amp; f: r.findings){ if(severity_rank_enum(f.severity)&lt;minRank) continue; nd &lt;&lt; '{' &lt;&lt; &quot;\&quot;type\&quot;:\&quot;finding\&quot;,\&quot;scanner\&quot;:\&quot;&quot;&lt;&lt;escape(r.scanner_name)&lt;&lt;&quot;\&quot;,\&quot;id\&quot;:\&quot;&quot;&lt;&lt;escape(f.id)&lt;&lt;&quot;\&quot;,\&quot;severity\&quot;:\&quot;&quot;&lt;&lt;escape(severity_to_string(f.severity))&lt;&lt;&quot;\&quot;,\&quot;base_severity_score\&quot;:&quot;&lt;&lt;f.base_severity_score; if(f.operational_error) nd &lt;&lt; &quot;,\&quot;operational_error\&quot;:true&quot;; auto it=f.metadata.find(&quot;mitre_techniques&quot;); if(it!=f.metadata.end()) nd &lt;&lt; &quot;,\&quot;mitre_techniques\&quot;:\&quot;&quot;&lt;&lt;escape(it-&gt;second)&lt;&lt;&quot;\&quot;&quot;; nd &lt;&lt; '}'; nd &lt;&lt; &quot;\n&quot;; } } return nd.str(); }</span></span>
<span id="L175"><span class="lineNum">     175</span> <span class="tlaGNC">      154409 :     std::ostringstream os; canon_emit(root, os); std::string compact=os.str(); auto prettyfn=[&amp;](const std::string&amp; min){ std::string out; out.reserve(min.size()*2); int depth=0; bool in_string=false; bool esc=false; auto indent=[&amp;](int d){ for(int i=0;i&lt;d;i++) out.append(&quot;  &quot;); }; for(size_t i=0;i&lt;min.size();++i){ char c=min[i]; out.push_back(c); if(esc){ esc=false; continue; } if(c=='\\'){ esc=true; continue; } if(c=='&quot;'){ in_string=!in_string; continue; } if(in_string) continue; switch(c){ case '{': case '[': out.push_back('\n'); depth++; indent(depth); break; case '}': case ']': out.push_back('\n'); depth--; if(depth&lt;0) depth=0; indent(depth); break; case ',': out.push_back('\n'); indent(depth); break; case ':': out.push_back(' '); break; default: break; } } out.push_back('\n'); return out; };</span></span>
<span id="L176"><span class="lineNum">     176</span> <span class="tlaGNC">          58 :     if(cfg.pretty &amp;&amp; !cfg.compact) return prettyfn(compact);</span></span>
<span id="L177"><span class="lineNum">     177</span> <span class="tlaGNC">          54 :     return compact;</span></span>
<span id="L178"><span class="lineNum">     178</span> <span class="tlaGNC">          72 : }</span></span>
<span id="L179"><span class="lineNum">     179</span>              : </span>
<span id="L180"><span class="lineNum">     180</span>              : } // namespace sys_scan</span>
        </pre>
              </td>
            </tr>
          </table>
          <br>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
            <tr><td class="versionInfo">Generated by: <a href="https://github.com//linux-test-project/lcov" target="_parent">LCOV version 2.0-1</a></td></tr>
          </table>
          <br>

</body>
</html>
